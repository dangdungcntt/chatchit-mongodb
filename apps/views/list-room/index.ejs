<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>List Room - ChatChit</title>
		<% include ../base-js-css %>
		<% include ../nav/js-css %>
		<link rel="stylesheet" href="/css/list-room/style.css">
	</head>
	<body>
	<% include ../nav/index %>
		<div class="container">
			<a href="/create-room/"><div id="addRoom" class="chat_room" title="Create room"></div></a>
		</div>
		<script type="text/javascript">
			'use strict';

			let hostname = location.protocol + '//' + location.host;
			let socket = io(hostname + '/list-room'); // jshint ignore:line

			socket.on('send-list-room', (listRoom) => {
				listRoom.forEach((room) => {
					let s = '<a href="/room/' + room.roomid + '"><div class="chat_room"><img src="' + room.roomimage +'" alt="' + room.roomname + '"><div class="crop"><b title="' + room.roomname + '">' + room.roomname + '</b><br>Online <span class="text-muted" id="' + room.roomid + '">' + room.listUser.length +  '</span></div></div></a>';
					$('.container').append(s);
				});
			});
			socket.on('new-room-created', (room) => {
				let s = '<a href="/room/' + room.roomid + '"><div class="chat_room"><img src="' + room.roomimage +'" alt="' + room.roomname + '"><div class="crop"><b title="' + room.roomname + '">' + room.roomname + '</b><br>Online <span class="text-muted" id="' + room.roomid + '">0</span></div></div></a>';
				$('.container').append(s);
			});

			let online = (roomid, aFlag) => {
				let s = Number($("#" + roomid).text());
    			s = s + aFlag;
    			$("#" + roomid).text(s);
			};

			socket.on('a-user-joined-room', (roomid) => {
				online(roomid, 1);
			});

			socket.on('a-user-leaved-room', (roomid) => {
					online(roomid, -1);
			});


		</script>
	</body>
</html>